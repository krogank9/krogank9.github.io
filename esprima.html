<!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style>
		textarea{resize: none; scroll: none;}
		::-webkit-input-placeholder { /* WebKit, Blink, Edge */
			 color:    #000;
		}
		:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
			color:    #000;
			opacity:  1;
		}
		::-moz-placeholder { /* Mozilla Firefox 19+ */
			color:    #000;
			opacity:  1;
		}
		:-ms-input-placeholder { /* Internet Explorer 10-11 */
			color:    #000;
		}
	</style>
</head>
<body>
	
<h2 style="font-weight: normal;">Convert .js to geany .js.tags format</h2>
Minimum function name length when parsing: <input type="number" id="minFuncLength" style="width: 50px;" min="1" value="4"></input>
<div style="padding: 7px 0px;"><input id="uploadSingle" type="file" multiple></input></div>
<textarea id="source" rows="10" cols="75"></textarea>
<div id="saveDiv" style="display: none; padding-top: 4px;">
	<textarea id="user_input" rows="1" cols="75" placeholder="type function or variable"></textarea>
	<form id="saveForm" action="javascript:void(0);">
		<input type="text" id="saveName" value="mylib.js.tags"></input>
		<input type="submit" id="saveButton" value="Save"></input>
		<span>Output should be OK, but have a look and edit it if needed</span>
	</form>
</div>

<script src="esprima.js"></script>
<script src="FileSaver.js"></script>
<script src="recurse_esprima_tree.js"></script>
<script>
	var input = document.getElementById("user_input");
	var source = document.getElementById("source");
	window.addEventListener('DOMContentLoaded', function() {
		source.value = "Click 'Choose files' (folders not supported)\n\nOr, drag & drop javascript files/folders into this box (Requires Chrome >= v21)";
	});
	/*source.onchange = function(evt) { 
		var tree = esprima.parse(this.value);
		console.log(tree);
		recurse_tree(tree);
	}*/
	input.oninput = function(evt) { makeSuggestions(); };
	function makeSuggestions() {
		if(!functions || functions.length == 0) return;
		source.value = "";
		var text = input.value;
		if(text.length < 2) return;
		// when typing function parameters, show sub functions
		var dotPos = text.indexOf('.');
		var parent = "";
		if(dotPos > -1) {
			parent = text.substring(0,dotPos);
			text = text.substring(dotPos+1);
		}
		text = text.replace(/\(.*/,"");
		
		var numSuggests = 0;
		for(var i=0; functions && i<functions.length; i++) {
			if( strInStr(functions[i].name,text,0) && (!parent || functions[i].parent == parent) ) {
				if(numSuggests>0) source.value += "\n";
				source.value += functions[i].name;
				if(functions[i].params.length > 0) {
					source.value += "(";
					for(var j=0; j<functions[i].params.length; j++) {
						if(j>0) source.value +=	 ", ";
						source.value += functions[i].params[j];
					}
					source.value += ")";
					if(!parent && functions[i].parent) {
						source.value += ` : ${functions[i].parent}`;
					}
				}
				numSuggests++;
			}
		}
	}
</script>

</body>
</html>
